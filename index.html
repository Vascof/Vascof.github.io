<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vasco Ferreira</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  /* ── DESIGN TOKENS ── */
  :root {
    --bg:      #0e0e0e;
    --surface: #161616;
    --border:  #252525;
    --muted:   #4e4e4e;
    --subtle:  #808080;
    --body:    #c0bab2;
    --heading: #eee8df;
    --accent:  #c9a96e;
    --teal:    #7eb8a4;
    --lilac:   #b48cba;
    --blue:    #6aaed6;
    --green:   #85b87a;
    --ff-display: 'Playfair Display', Georgia, serif;
    --ff-body:    'DM Sans', sans-serif;
    --ff-mono:    'DM Mono', monospace;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html { font-size: 16px; scroll-behavior: smooth; }
  body {
    background: var(--bg);
    color: var(--body);
    font-family: var(--ff-body);
    font-weight: 300;
    line-height: 1.75;
    min-height: 100vh;
  }

  /* grain */
  body::after {
    content: '';
    position: fixed; inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");
    pointer-events: none; z-index: 9999;
  }

  /* ── LAYOUT ── */
  .page { max-width: 860px; margin: 0 auto; padding: 0 2rem 8rem; }

  /* ── TOOLBAR ── */
  .toolbar {
    position: sticky; top: 0; z-index: 100;
    background: rgba(14,14,14,.95);
    backdrop-filter: blur(16px);
    border-bottom: 1px solid var(--border);
    padding: .65rem 2rem;
    display: flex; align-items: center; gap: .5rem; flex-wrap: wrap;
    margin: 0 -2rem;
  }
  .toolbar-label {
    font-family: var(--ff-mono); font-size: .58rem;
    letter-spacing: .2em; text-transform: uppercase;
    color: var(--muted); margin-right: .25rem; white-space: nowrap;
  }
  /* filter buttons are injected by JS from tagging */
  .filter-btn {
    font-family: var(--ff-mono); font-size: .65rem;
    letter-spacing: .06em; padding: .26rem .8rem;
    border-radius: 2px; border: 1px solid var(--border);
    background: transparent; color: var(--subtle);
    cursor: pointer; transition: all .18s; white-space: nowrap;
  }
  .filter-btn:hover { border-color: var(--accent); color: var(--accent); }

  /* active state — each tab gets one of four accent colours by index */
  .filter-btn.active { color: #0d0d0d; font-weight: 500; }
  .filter-btn.active[data-idx="0"] { background: var(--accent); border-color: var(--accent); }
  .filter-btn.active[data-idx="1"] { background: var(--teal);   border-color: var(--teal); }
  .filter-btn.active[data-idx="2"] { background: var(--blue);   border-color: var(--blue); }
  .filter-btn.active[data-idx="3"] { background: var(--lilac);  border-color: var(--lilac); }

  .print-btn {
    margin-left: auto;
    font-family: var(--ff-mono); font-size: .6rem;
    letter-spacing: .1em; padding: .26rem .8rem;
    border-radius: 2px; border: 1px solid var(--border);
    background: transparent; color: var(--muted);
    cursor: pointer; transition: all .18s; white-space: nowrap;
  }
  .print-btn:hover { border-color: var(--body); color: var(--body); }

  /* ── HEADER ── */
  header {
    padding: 5rem 0 3rem;
    border-bottom: 1px solid var(--border);
    position: relative;
  }
  header::after {
    content: ''; position: absolute; bottom: -1px; left: 0;
    width: 64px; height: 2px; background: var(--accent);
  }
  .header-eyebrow {
    font-family: var(--ff-mono); font-size: .6rem;
    letter-spacing: .22em; text-transform: uppercase;
    color: var(--accent); margin-bottom: .9rem;
  }
  h1 {
    font-family: var(--ff-display);
    font-size: clamp(2.8rem, 8vw, 5rem);
    font-weight: 700; color: var(--heading);
    line-height: 1; letter-spacing: -.02em; margin-bottom: .45rem;
  }
  .tagline { font-size: .88rem; color: var(--subtle); letter-spacing: .04em; margin-bottom: 1.8rem; }
  .contact-row {
    display: flex; gap: 1.8rem; flex-wrap: wrap;
    font-family: var(--ff-mono); font-size: .7rem; color: var(--muted);
  }
  .contact-row a { color: var(--accent); text-decoration: none; }
  .contact-row a:hover { text-decoration: underline; }

  /* ── SECTIONS ── */
  section { margin-top: 3.5rem; }
  section.sec-hidden { display: none !important; }

  .section-label {
    font-family: var(--ff-mono); font-size: .57rem;
    letter-spacing: .28em; text-transform: uppercase;
    color: var(--accent); margin-bottom: 1.6rem;
    display: flex; align-items: center; gap: 1rem;
  }
  .section-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }

  /* ── ABOUT ── */
  .about-text {
    font-size: .93rem; color: var(--body);
    line-height: 1.9; max-width: 680px;
    border-left: 2px solid var(--accent);
    padding-left: 1.4rem;
    margin-bottom: 1rem;
  }
  .about-text.item-hidden { display: none !important; }

  /* ── EXP / PROJECT CARDS ── */
  .exp-item {
    padding: 1.6rem 0; border-bottom: 1px solid var(--border);
    display: grid; grid-template-columns: 160px 1fr; gap: 2rem;
    animation: fadeUp .4s ease both;
  }
  .exp-item.item-hidden { display: none !important; }
  .exp-meta { padding-top: .15rem; }
  .exp-period { font-family: var(--ff-mono); font-size: .67rem; color: var(--muted); line-height: 1.6; margin-bottom: .3rem; }
  .exp-location { font-family: var(--ff-mono); font-size: .6rem; color: var(--muted); opacity: .65; }
  .exp-role {
    font-family: var(--ff-display); font-size: 1.05rem;
    color: var(--heading); font-weight: 400; margin-bottom: .15rem;
  }
  .exp-org-row { display: flex; align-items: baseline; gap: .6rem; margin-bottom: .75rem; }
  .exp-org { font-family: var(--ff-mono); font-size: .72rem; color: var(--accent); letter-spacing: .04em; }
  .exp-link {
    font-family: var(--ff-mono); font-size: .6rem; color: var(--muted);
    text-decoration: none; border-bottom: 1px solid var(--border); padding-bottom: 1px;
    transition: color .15s, border-color .15s;
  }
  .exp-link:hover { color: var(--accent); border-color: var(--accent); }
  .exp-desc { font-size: .84rem; color: var(--body); line-height: 1.8; }
  .exp-desc ul { padding-left: 1.1rem; }
  .exp-desc li { margin-bottom: .35rem; }
  .skill-tags { display: flex; gap: .35rem; flex-wrap: wrap; margin-top: .8rem; }
  .skill-tag {
    font-family: var(--ff-mono); font-size: .57rem;
    letter-spacing: .07em; padding: .17rem .5rem;
    border-radius: 2px; text-transform: uppercase;
    border: 1px solid rgba(201,169,110,.35);
    color: var(--accent); background: rgba(201,169,110,.07);
  }

  /* ── EDUCATION ── */
  .edu-item {
    padding: 1.4rem 0; border-bottom: 1px solid var(--border);
    display: grid; grid-template-columns: 160px 1fr; gap: 2rem;
  }
  .edu-item.item-hidden { display: none !important; }
  .edu-period { font-family: var(--ff-mono); font-size: .67rem; color: var(--muted); padding-top: .15rem; }
  .edu-degree { font-family: var(--ff-display); font-size: 1rem; color: var(--heading); margin-bottom: .18rem; }
  .edu-school { font-family: var(--ff-mono); font-size: .72rem; color: var(--accent); margin-bottom: .45rem; }
  .edu-note { font-size: .82rem; color: var(--subtle); line-height: 1.7; }

  /* ── SKILLS ── */
  .skills-outer { display: grid; grid-template-columns: repeat(auto-fill, minmax(190px, 1fr)); gap: 1.5rem; }
  .skill-group { }
  .skill-group.item-hidden { display: none !important; }
  .skill-group h3 {
    font-family: var(--ff-mono); font-size: .6rem;
    letter-spacing: .2em; text-transform: uppercase;
    color: var(--subtle); margin-bottom: .75rem;
  }
  .pill-row { display: flex; flex-wrap: wrap; gap: .35rem; }
  .pill {
    font-family: var(--ff-mono); font-size: .68rem;
    padding: .22rem .6rem; border: 1px solid var(--border);
    border-radius: 2px; color: var(--subtle);
    transition: border-color .15s, color .15s;
  }
  .pill:hover { border-color: var(--accent); color: var(--accent); }

  /* ── LANGUAGES ── */
  .lang-row {
    display: grid; grid-template-columns: 130px 1fr 130px;
    align-items: center; gap: 1rem;
    padding: .55rem 0; border-bottom: 1px solid var(--border);
  }
  .lang-name { font-size: .88rem; color: var(--body); }
  .lang-bar  { height: 1px; background: var(--border); }
  .lang-fill { height: 2px; margin-top: -1px; background: var(--accent); border-radius: 1px; }
  .lang-level { font-family: var(--ff-mono); font-size: .62rem; color: var(--muted); text-align: right; }

  /* ── CERTS ── */
  .cert-row { display: flex; gap: .8rem; flex-wrap: wrap; }
  .cert-card {
    border: 1px solid var(--border); padding: .9rem 1.3rem;
    background: var(--surface); transition: border-color .15s;
  }
  .cert-issuer { font-family: var(--ff-mono); font-size: .6rem; color: var(--accent); margin-bottom: .25rem; letter-spacing: .1em; }
  .cert-name   { font-size: .85rem; color: var(--heading); }

  /* ── HOBBIES ── */
  .hobby-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(148px, 1fr));
    gap: 1px; border: 1px solid var(--border); background: var(--border);
  }
  .hobby-card { background: var(--surface); padding: 1.3rem 1.1rem; transition: background .15s; }
  .hobby-card:hover { background: #1a1a1a; }
  .hobby-icon { font-size: 1.4rem; margin-bottom: .5rem; }
  .hobby-name { font-size: .9rem; color: var(--heading); margin-bottom: .25rem; }
  .hobby-note { font-size: .74rem; color: var(--muted); line-height: 1.6; }

  /* ── TRAVEL ── */
  .travel-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(210px, 1fr)); gap: .8rem; }
  .travel-card {
    border: 1px solid var(--border); padding: 1.2rem;
    background: var(--surface); transition: border-color .15s;
  }
  .travel-card.item-hidden { display: none !important; }
  .travel-card:hover { border-color: var(--teal); }
  .travel-region { font-family: var(--ff-mono); font-size: .58rem; letter-spacing: .2em; text-transform: uppercase; color: var(--teal); margin-bottom: .35rem; }
  .travel-title  { font-family: var(--ff-display); font-size: .97rem; color: var(--heading); margin-bottom: .35rem; }
  .travel-note   { font-size: .77rem; color: var(--muted); line-height: 1.65; }

  /* ── IMPOSSIBLE LIST ── */
  .imp-intro {
    font-size: .88rem; color: var(--subtle);
    max-width: 600px; line-height: 1.8;
    margin-bottom: 2.5rem;
    padding-left: 1.4rem;
    border-left: 2px solid var(--border);
  }
  .imp-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
  }
  .imp-bucket { border: 1px solid var(--border); background: var(--surface); overflow: hidden; }
  .imp-bucket.item-hidden { display: none !important; }
  .imp-bucket-header {
    padding: .9rem 1.2rem; border-bottom: 1px solid var(--border);
    display: flex; align-items: center; gap: .6rem;
    background: rgba(255,255,255,.02);
  }
  .imp-bucket-icon { font-size: 1.1rem; }
  .imp-bucket-name {
    font-family: var(--ff-mono); font-size: .65rem;
    letter-spacing: .15em; text-transform: uppercase; color: var(--subtle);
  }
  .imp-progress { font-family: var(--ff-mono); font-size: .58rem; color: var(--muted); margin-left: auto; }
  .imp-items { padding: .6rem 0; }
  .imp-item {
    padding: .65rem 1.2rem;
    display: flex; gap: .75rem; align-items: flex-start;
    border-bottom: 1px solid rgba(255,255,255,.04);
    text-decoration: none; transition: background .12s; cursor: default;
  }
  .imp-item.has-link { cursor: pointer; }
  .imp-item:last-child { border-bottom: none; }
  .imp-item:hover { background: rgba(255,255,255,.03); }
  .imp-check {
    width: 14px; height: 14px; min-width: 14px;
    border-radius: 50%; margin-top: .28rem;
    border: 1.5px solid var(--muted);
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .imp-check.done  { background: var(--green); border-color: var(--green); }
  .imp-check.done::after { content: '✓'; font-size: .55rem; color: #0d0d0d; font-weight: 700; line-height: 1; }
  .imp-check.next  { border-color: var(--accent); border-style: dashed; }
  .imp-item-body { flex: 1; min-width: 0; }
  .imp-item-title { font-size: .84rem; color: var(--body); line-height: 1.4; }
  .imp-item-title.done-text { color: var(--subtle); text-decoration: line-through; text-decoration-color: var(--border); }
  .imp-item-title.next-text { color: var(--heading); }
  .imp-item-note  { font-size: .73rem; color: var(--muted); margin-top: .2rem; line-height: 1.5; }
  .imp-arrow { font-size: .7rem; color: var(--muted); margin-top: .3rem; opacity: .5; }

  /* ── FOOTER ── */
  footer {
    margin-top: 5rem; padding-top: 1.5rem; border-top: 1px solid var(--border);
    display: flex; justify-content: space-between; flex-wrap: wrap; gap: .5rem;
    font-family: var(--ff-mono); font-size: .6rem; color: var(--muted);
  }

  /* ── ANIMATIONS ── */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(14px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* ── PRINT ── */
  @media print {
    .toolbar, body::after { display: none !important; }
    :root { --bg:#fff; --surface:#fff; --border:#ddd; --body:#444; --heading:#111; --accent:#8b6914; --teal:#2d7a68; --muted:#888; --subtle:#666; }
    body { background: #fff; }
    .item-hidden, .sec-hidden { display: none !important; }
    header { padding: 2rem 0 1.5rem; }
    h1 { font-size: 3rem; }
    section { margin-top: 2rem; }
  }

  /* ── RESPONSIVE ── */
  @media (max-width: 580px) {
    .exp-item, .edu-item { grid-template-columns: 1fr; gap: .4rem; }
    h1 { font-size: 2.6rem; }
    .imp-grid { grid-template-columns: 1fr; }
    .toolbar { gap: .35rem; }
    .filter-btn { font-size: .6rem; padding: .22rem .6rem; }
  }
</style>
</head>
<body>

<nav class="toolbar" id="toolbar">
  <span class="toolbar-label">View as:</span>
  <!-- tabs injected by JS from data.tagging -->
  <button class="print-btn" onclick="window.print()">⬒ Print / PDF</button>
</nav>

<div class="page">
  <div id="root"></div>
</div>

<script>
// ═══════════════════════════════════════════════════════════════
//  RENDERER
//  Tabs and their tag strings are driven entirely by data.tagging.
//  Sections/items appear only when they have at least one item
//  whose tags include the active tab's tag string.
//  You should never need to edit this file.
// ═══════════════════════════════════════════════════════════════

async function loadData() {
  try {
    const res = await fetch('./data.json');
    if (!res.ok) throw new Error('Cannot load data.json');
    return res.json();
  } catch(e) {
    console.error(e);
    return null;
  }
}

// ── tag helpers ──────────────────────────────────────────────

// Normalize tags: always return an array of strings
function normTags(tags) {
  if (!tags) return [];
  if (Array.isArray(tags)) return tags.map(String);
  return [String(tags)];
}

// Does this item match the active tag?
// "pro" (Full Profile) shows everything that has any tag at all.
function matches(itemTags, activeTag, allTags) {
  const t = normTags(itemTags);
  if (t.length === 0) return false; // items with no tags are never shown
  // The first tab's tag is "Full Profile" — show all tagged items
  const firstTag = allTags[0].tags;
  if (activeTag === firstTag) return true;
  return t.includes(activeTag);
}

// ── HTML helpers ─────────────────────────────────────────────

function optLink(url, label) {
  if (!url) return '';
  return `<a class="exp-link" href="${url}" target="_blank" rel="noopener">↗ ${label}</a>`;
}

function bulletsHTML(bullets) {
  if (!bullets || !bullets.length) return '';
  return `<ul>${bullets.map(b => `<li>${b}</li>`).join('')}</ul>`;
}

function skillTagsHTML(skills) {
  if (!skills || !skills.length) return '';
  return `<div class="skill-tags">${skills.map(s => `<span class="skill-tag">${s}</span>`).join('')}</div>`;
}

// ── section renderers ─────────────────────────────────────────

function renderAbout(items, allTags) {
  // about is an array of {text, tags}
  return items.map(a => {
    const t = normTags(a.tags);
    return `<p class="about-text" data-tags="${t.join(' ')}">${a.text}</p>`;
  }).join('');
}

function renderExpItems(items, allTags) {
  return items.map((e, i) => {
    const t = normTags(e.tags);
    const title = e.role || e.name || '';
    const bullets = e.bullets || (e.description ? [e.description] : []);
    return `
    <div class="exp-item" data-tags="${t.join(' ')}" style="animation-delay:${i*.05}s">
      <div class="exp-meta">
        <div class="exp-period">${e.period || ''}</div>
        <div class="exp-location">${e.location || ''}</div>
      </div>
      <div>
        <div class="exp-role">${title}</div>
        <div class="exp-org-row">
          <span class="exp-org">${e.org || ''}</span>
          ${optLink(e.link, e.org)}
        </div>
        <div class="exp-desc">${bulletsHTML(bullets)}</div>
        ${skillTagsHTML(e.skills)}
      </div>
    </div>`;
  }).join('');
}

function renderEducation(items, allTags) {
  // education items may not have tags — default to ["pro","tech"]
  return items.map(e => {
    const t = normTags(e.tags).length ? normTags(e.tags) : ['pro','tech','com'];
    return `
    <div class="edu-item" data-tags="${t.join(' ')}">
      <div class="edu-period">${e.period}</div>
      <div>
        <div class="edu-degree">${e.degree}</div>
        <div class="edu-school">${e.school}${e.link ? ` — ${optLink(e.link, e.school)}` : ''}</div>
        ${e.note ? `<div class="edu-note">${e.note}</div>` : ''}
      </div>
    </div>`;
  }).join('');
}

function renderSkills(groups, allTags) {
  return `<div class="skills-outer">${groups.map(g => {
    const t = normTags(g.tags).length ? normTags(g.tags) : ['pro'];
    return `
    <div class="skill-group" data-tags="${t.join(' ')}">
      <h3>${g.group}</h3>
      <div class="pill-row">${g.items.map(i => `<span class="pill">${i}</span>`).join('')}</div>
    </div>`;
  }).join('')}</div>`;
}

function renderLanguages(langs) {
  return `<div style="max-width:480px">${langs.map(l => `
    <div class="lang-row">
      <span class="lang-name">${l.name}</span>
      <div class="lang-bar"><div class="lang-fill" style="width:${l.pct}%"></div></div>
      <span class="lang-level">${l.level}</span>
    </div>`).join('')}</div>`;
}

function renderCerts(certs) {
  return `<div class="cert-row">${certs.map(c => `
    <div class="cert-card">
      <div class="cert-issuer">${c.issuer}</div>
      <div class="cert-name">${c.name}</div>
    </div>`).join('')}</div>`;
}

function renderHobbies(hobbies) {
  // hobbies have no tags — treated as "pro" only
  return `<div class="hobby-grid">${hobbies.map(h => `
    <div class="hobby-card">
      <div class="hobby-icon">${h.icon}</div>
      <div class="hobby-name">${h.name}</div>
      <div class="hobby-note">${h.note}</div>
    </div>`).join('')}</div>`;
}

function renderTravel(trips) {
  return `<div class="travel-grid">${trips.map(t => {
    const tags = normTags(t.tags);
    return `
    <div class="travel-card" data-tags="${tags.join(' ')}">
      <div class="travel-region">${t.region}</div>
      <div class="travel-title">${t.title}</div>
      <div class="travel-note">${t.note}</div>
    </div>`;
  }).join('')}</div>`;
}

function renderImpossibleList(buckets) {
  return buckets.map(bucket => {
    const bucketTags = normTags(bucket.tag || bucket.tags || ['goal']);
    const total = bucket.items.length;
    const done  = bucket.items.filter(i => i.done).length;
    const firstNext = bucket.items.findIndex(i => !i.done);

    const itemsHTML = bucket.items.map((item, idx) => {
      const isNext = idx === firstNext;
      const checkCls = item.done ? 'done' : (isNext ? 'next' : '');
      const titleCls = item.done ? 'done-text' : (isNext ? 'next-text' : '');
      const inner = `
        <div class="imp-check ${checkCls}"></div>
        <div class="imp-item-body">
          <div class="imp-item-title ${titleCls}">${item.title}</div>
          ${item.note ? `<div class="imp-item-note">${item.note}</div>` : ''}
        </div>
        ${item.link ? `<span class="imp-arrow">↗</span>` : ''}`;
      return item.link
        ? `<a class="imp-item has-link" href="${item.link}" target="_blank" rel="noopener">${inner}</a>`
        : `<div class="imp-item">${inner}</div>`;
    }).join('');

    return `
    <div class="imp-bucket" data-tags="${bucketTags.join(' ')}">
      <div class="imp-bucket-header">
        <span class="imp-bucket-icon">${bucket.icon}</span>
        <span class="imp-bucket-name">${bucket.bucket}</span>
        <span class="imp-progress">${done}/${total}</span>
      </div>
      <div class="imp-items">${itemsHTML}</div>
    </div>`;
  }).join('');
}

// ── main render ───────────────────────────────────────────────

function render(d) {
  const allTags = d.tagging; // [{name, tags}, ...]
  const firstTag = allTags[0].tags; // the "Full Profile" tag

  const contact = [
    d.meta.email    ? `<a href="mailto:${d.meta.email}">${d.meta.email}</a>` : '',
    d.meta.linkedin ? `<a href="${d.meta.linkedin}" target="_blank" rel="noopener">LinkedIn</a>` : '',
    d.meta.github   ? `<a href="${d.meta.github}" target="_blank" rel="noopener">GitHub</a>` : '',
    d.meta.website  ? `<a href="${d.meta.website}" target="_blank" rel="noopener">${d.meta.website}</a>` : '',
    `<span>${d.meta.location}</span>`
  ].filter(Boolean).join('');

  // Build tabs from tagging
  const tabsHTML = allTags.map((t, i) =>
    `<button class="filter-btn${i===0?' active':''}" data-tag="${t.tags}" data-idx="${i}">${t.name}</button>`
  ).join('');

  // Inject tabs before print button
  const toolbar = document.getElementById('toolbar');
  const printBtn = toolbar.querySelector('.print-btn');
  const label = toolbar.querySelector('.toolbar-label');
  allTags.forEach((t, i) => {
    const btn = document.createElement('button');
    btn.className = 'filter-btn' + (i===0?' active':'');
    btn.dataset.tag = t.tags;
    btn.dataset.idx = i;
    btn.textContent = t.name;
    toolbar.insertBefore(btn, printBtn);
  });

  // Get the short key for the internships section (whatever key it is in the JSON)
  const internKey = Object.keys(d).find(k =>
    k !== 'experience' && Array.isArray(d[k]) && d[k][0] && d[k][0].bullets && d[k][0].role !== undefined && k !== 'projects'
  );
  const internItems = internKey ? d[internKey] : [];
  const internLabel = internKey
    ? internKey.replace(/_/g,' ').replace(/\b\w/g, c => c.toUpperCase())
    : 'Internships & Short Periods';

  // Detect which sections have at least one item per tag
  // We collect all tag-sets needed per section
  const intlItems = d.international || d.travel || [];
  const hasIntlTags = intlItems.some(t => normTags(t.tags).length > 0);

  document.getElementById('root').innerHTML = `

    <header>
      <p class="header-eyebrow">Portfolio · ${d.meta.location}</p>
      <h1>${d.meta.name.split(' ').join('<br>')}</h1>
      <p class="tagline">${d.meta.title}</p>
      <div class="contact-row">${contact}</div>
    </header>

    <!-- ABOUT -->
    <section id="sec-about" data-section-tags="${d.about.map(a=>normTags(a.tags).join(' ')).join(' ')}">
      <p class="section-label">About</p>
      ${renderAbout(d.about, allTags)}
    </section>

    <!-- EXPERIENCE -->
    <section id="sec-exp" data-section-tags="${d.experience.map(e=>normTags(e.tags).join(' ')).join(' ')}">
      <p class="section-label">Experience</p>
      ${renderExpItems(d.experience, allTags)}
    </section>

    <!-- INTERNSHIPS / SHORT GIGS -->
    ${internItems.length ? `
    <section id="sec-intern" data-section-tags="${internItems.map(e=>normTags(e.tags).join(' ')).join(' ')}">
      <p class="section-label">${internLabel}</p>
      ${renderExpItems(internItems, allTags)}
    </section>` : ''}

    <!-- EDUCATION -->
    <section id="sec-edu" data-section-tags="${d.education.map(e=>normTags(e.tags||['pro','tech']).join(' ')).join(' ')}">
      <p class="section-label">Education</p>
      ${renderEducation(d.education, allTags)}
    </section>

    <!-- SKILLS -->
    <section id="sec-skills" data-section-tags="${d.skills.map(g=>normTags(g.tags||['pro']).join(' ')).join(' ')}">
      <p class="section-label">Skills &amp; Tools</p>
      ${renderSkills(d.skills, allTags)}
    </section>

    <!-- LANGUAGES -->
    <section id="sec-langs" data-section-tags="${allTags.map(t=>t.tags).join(' ')}">
      <p class="section-label">Languages</p>
      ${renderLanguages(d.languages)}
    </section>

    <!-- CERTIFICATIONS -->
    <section id="sec-certs" data-section-tags="pro tech">
      <p class="section-label">Certifications</p>
      ${renderCerts(d.certifications)}
    </section>

    <!-- HOBBIES -->
    <section id="sec-hobbies" data-section-tags="pro goal">
      <p class="section-label">Hobbies</p>
      ${renderHobbies(d.hobbies)}
    </section>

    <!-- INTERNATIONAL EXPERIENCES -->
    ${hasIntlTags ? `
    <section id="sec-international" data-section-tags="${intlItems.map(t=>normTags(t.tags).join(' ')).join(' ')}">
      <p class="section-label">International Experiences</p>
      ${renderTravel(intlItems)}
    </section>` : ''}

    <!-- PROJECTS -->
    ${d.projects && d.projects.length ? `
    <section id="sec-projects" data-section-tags="${d.projects.map(p=>normTags(p.tags).join(' ')).join(' ')}">
      <p class="section-label">Projects</p>
      ${renderExpItems(d.projects, allTags)}
    </section>` : ''}

    <!-- IMPOSSIBLE LIST -->
    <section id="sec-impossible" data-section-tags="${d.impossibleList.map(b=>normTags(b.tag||b.tags||['goal']).join(' ')).join(' ')}">
      <p class="section-label">Impossible List</p>
      <p class="imp-intro">
        A living list of things I want to do, learn, and become. Each item connects to the next.
        <span style="color:var(--green)">✓ done</span> items lead to new ones.
        The <span style="color:var(--accent)">dashed circle</span> marks what's next in each chain.
      </p>
      <div class="imp-grid">${renderImpossibleList(d.impossibleList)}</div>
    </section>

    <footer>
      <span>${d.meta.name} · ${d.meta.title.trim()}</span>
      <span>Last updated: ${d.meta.lastUpdated}</span>
    </footer>
  `;

  document.title = d.meta.name + ' — ' + d.meta.title.trim();
  initFilters(allTags, firstTag);
}

// ── filter engine ─────────────────────────────────────────────

function initFilters(allTags, firstTag) {
  const btns     = document.querySelectorAll('.filter-btn');
  const sections = document.querySelectorAll('section[data-section-tags]');

  function applyFilter(activeTag) {
    const isFullProfile = (activeTag === firstTag);

    // Selectors for all individually-tagged items
    const ITEM_SEL = '.about-text[data-tags], .exp-item[data-tags], .edu-item[data-tags], .skill-group[data-tags], .travel-card[data-tags], .imp-bucket[data-tags]';

    sections.forEach(sec => {
      // Step 1 — filter every tagged item strictly by its own tags.
      // Full Profile does NOT mean "show everything" — it means show items
      // that include the firstTag (e.g. "pro") in their own tags array.
      const typedItems = sec.querySelectorAll(ITEM_SEL);

      typedItems.forEach(el => {
        const t = (el.dataset.tags || '').split(/\s+/).filter(Boolean);
        // An item is visible only if its own tags include the active tag.
        el.classList.toggle('item-hidden', !t.includes(activeTag));
      });

      // Step 2 — hide the whole section if it has typed items but none are visible,
      // or if it has no typed items and it isn't a "static" section (languages, certs, hobbies).
      if (typedItems.length > 0) {
        const anyVisible = [...typedItems].some(el => !el.classList.contains('item-hidden'));
        sec.classList.toggle('sec-hidden', !anyVisible);
      } else {
        // Sections with no individually-tagged items (languages, certs, hobbies)
        // use data-section-tags to decide visibility.
        const secTags = (sec.dataset.sectionTags || '').split(/\s+/).filter(Boolean);
        sec.classList.toggle('sec-hidden', !secTags.includes(activeTag));
      }
    });
  }

  btns.forEach(btn => {
    btn.addEventListener('click', () => {
      btns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      applyFilter(btn.dataset.tag);
    });
  });

  // Init
  applyFilter(firstTag);
}

// ── boot ──────────────────────────────────────────────────────

loadData().then(d => {
  if (d) {
    render(d);
  } else {
    document.getElementById('root').innerHTML = `
      <div style="padding:4rem;font-family:monospace;color:#c66;">
        ⚠ Could not load data.json.<br><br>
        Run a local server in the same folder:<br><br>
        <code style="background:#1a1a1a;padding:.5rem 1rem;display:inline-block;margin-top:.5rem">python3 -m http.server 8000</code><br><br>
        Then open <a href="http://localhost:8000" style="color:#c9a96e">http://localhost:8000</a>
      </div>`;
  }
});
</script>
</body>
</html>
